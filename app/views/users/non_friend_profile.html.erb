<script>
  $(document).ready(function() {
    $("#add-friend").click(function(e) {
      alert("friend being added");
      $.post("/friend_request/create", {
        user_id: "<%= current_user.id %>",
        friend_id: "<%= @viewed_user.id %>"
      });
      e.preventDefault();
      document.getElementById("add-friend").innerHTML = "Friend added!";
      document.getElementById("add-friend").disabled = true;
    });
  });
</script>

<div class="profile-name">
  <h1>
    <%= @viewed_user.first_name %> <%= @viewed_user.last_name %>
    <% if !@friend_request_exists %>
      <button id="add-friend">Add Friend</button>
    <% else %>
      <span> (request pending) </span>
    <% end %>
  </h1>
</div>
<ul class="profile-recent" id="non-friend-profile-recent">
  <% @newsfeed_hashes.each do |item| %>
  <li>
    <% time = item[:timestamp] %>

    <% case item[:type]
      when 'challenge'

      challenge = item[:challenge]
      sender = item[:sender]
      receiver = item[:receiver] %>

      <p><a href="/profile/<%= sender.username %>"><%= sender.first_name %> <%= sender.last_name %></a> challenged <a href="/profile/<%= receiver.username %>"><%= receiver.first_name %> <%= receiver.last_name %>!</a></p>
      <p class="time"><%= time.strftime("%b %d, %l:%M %P") %></p>
      <p><%= challenge.content %></p>
      
      <% when 'friendship'
        user1 = item[:user_1]
        user2 = item[:user_2]

        if user1.id == @viewed_user.id %>
          <p><a href="/profile/<%= user1.username %>"><%= user1.first_name %> <%= user1.last_name %></a> became friends with <a href="/profile/<%= user2.username %>"><%= user2.first_name %> <%= user2.last_name %></a></p>
        <% else %>
          <p><a href="/profile/<%= user2.username %>"><%= user2.first_name %> <%= user2.last_name %></a> became friends with <a href="/profile/<%= user1.username %>"><%= user1.first_name %> <%= user1.last_name %></a></p>
        <% end %>
        <p class="time"><%= time.strftime("%b %d, %l:%M %P") %></p>

      <% else %>

    <% end %>
  </li>
  <% end %>
</ul>